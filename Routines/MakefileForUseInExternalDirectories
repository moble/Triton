## Set this as the full (no '~') directory with Waveforms, including trailing '/'
BASE = /Users/boyle/Research/WaveExtrapolation/Waveforms/


## This is a basic executables-building makefile; the lines below shouldn't need much tweaking.
SUBLIBS = ${BASE}Utilities ${BASE}PostNewtonian ${BASE}Objects
include ${BASE}MachineDefs

VPATH = $(SUBLIBS)
SUFFIXES += .d
SOURCES = $(wildcard *.cpp)
EXECUTABLES = $(SOURCES:%.cpp=%)
IFLAGS:=$(SUBLIBS:%=-I%)
LFLAGS:=$(SUBLIBS:%=-L%)
lFLAGS:=$(SUBLIBS:${BASE}%=-l%)
LIBDEPS:=$(SUBLIBS:${BASE}%=lib%.a)

.PHONY: sublibs $(SUBLIBS) svnignore

all: sublibs $(EXECUTABLES) | svnignore

svnignore:
	@$(ECHO) .svnignore $(EXECUTABLES) | tr ' ' '\n' > .$@.tmp
	@test -f .$@ \
	  && ($(DIFF) .$@ .$@.tmp > .$@.diff; \
	      (test -s .$@.diff && (mv .$@.tmp .$@; svn propset svn:ignore . -F .svnignore) || ($(RM) .$@.tmp)); \
	      $(RM) .$@.diff) \
	  || (mv .$@.tmp .$@; svn propset svn:ignore . -F .svnignore)

clean:
	-$(RM) *.d $(EXECUTABLES) .svnignore

realclean:
	-$(RM) *.d $(EXECUTABLES) .svnignore

$(EXECUTABLES): % : %.cpp %.d $(LIBDEPS)
	$(C++) $(C++FLAGS) $*.cpp $(IFLAGS) $(LFLAGS) $(lFLAGS) -o $@

%.d : %.cpp
	@$(MAKEDEPEND) $(IFLAGS) -MT '$* $*.d' -MF $*.d $*.cpp

sublibs: $(SUBLIBS)

$(SUBLIBS):
	@$(MAKE) -C $@

lib%.a:
	@$(MAKE) -C ${BASE}$(subst lib,,$(basename $@)) $@

-include $(EXECUTABLES:=.d)
