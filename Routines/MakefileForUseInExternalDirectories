# -*- makefile -*-

## Set this as the directory with Waveforms, including trailing '/'
#BASE = $(wildcard /home/boyle/Triton/)
BASE = $(wildcard /Users/boyle/Research/Triton/)


## This is a basic executables-building makefile; the lines below shouldn't need much tweaking.
SUBLIBS = ${BASE}WaveformManip ${BASE}Objects ${BASE}PostNewtonian ${BASE}Utilities
include ${BASE}MachineDef

VPATH = $(SUBLIBS)
SUFFIXES += .d
SOURCES = $(wildcard *.cpp)
EXECUTABLES = $(SOURCES:%.cpp=%)
IFLAGS:=$(SUBLIBS:%=-I%)
LFLAGS:=$(SUBLIBS:%=-L%)
lFLAGS:=$(SUBLIBS:${BASE}%=-l%)
LIBDEPS:=$(SUBLIBS:${BASE}%=lib%.so)

.PHONY: sublibs $(SUBLIBS)

all: sublibs $(EXECUTABLES)

clean:
	-$(RM) *.d $(EXECUTABLES)

realclean:
	-$(RM) *.d $(EXECUTABLES)

$(EXECUTABLES): % : %.cpp %.d $(LIBDEPS)
	$(C++LINK) -Wl,-rpath,$(BASE)/lib $(C++FLAGS) $*.cpp $(IFLAGS) $(LFLAGS) $(lFLAGS) -o $@

%.d : %.cpp
	@$(MAKEDEPEND) $(IFLAGS) -MT '$* $*.d' -MF $*.d $*.cpp

sublibs: $(SUBLIBS)

$(SUBLIBS):
	@$(MAKE) -C $@

lib%.so:
	@$(MAKE) -C ${BASE}$(subst lib,,$(basename $@)) $@

-include $(EXECUTABLES:=.d)
